{# templates/admin/add.html #}
{% extends "admin/change_form.html" %}
{% load i18n admin_urls %}

{% block content %}
  {% if not object_id %}
  <div style="margin-top: 20px; border-top: 1px solid #eee; padding: 20px;">
    <h2>{% trans "Import Excel File" %}</h2>
    <form method="post" enctype="multipart/form-data" id="import-form">
      {% csrf_token %}
      <div>
        <label for="id_excel_file">{% trans "Choose an Excel file:" %}</label>
        <input
          type="file"
          name="excel_file"
          id="id_excel_file"
          accept=".xlsx, .xls"
          required
        >
        <div class="help-text" style="margin-top: .5em;">
          <p><strong>{% trans "Required fields in the imported file:" %}</strong></p>
          <ul>
            <li>code_acaps</li>
            <li>nom</li>
            <li>qualité</li>
            <li>mandante</li>
            <li>localité</li>
            <li>longitude</li>
            <li>latitude</li>
          </ul>
        </div>
        <input
          type="submit"
          name="_import_file"
          value="{% trans 'Import' %}"
          id="import-button"
          class="default"
          style="margin-top: 1em;"
        >
      </div>

      <div style="margin-top: 10px;">
        <progress id="import-progress" style="width:100%; display:none;"></progress>
        <p id="import-status" style="margin-top:5px;"></p>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('import-form');
      const fileInput = document.getElementById('id_excel_file');
      const importButton = document.getElementById('import-button');
      const progress = document.getElementById('import-progress');
      const status = document.getElementById('import-status');

      form.addEventListener('submit', (e) => {
        if (e.submitter === importButton) {
          if (!fileInput.files.length) {
            e.preventDefault();
            status.textContent = '{% trans "Please select an Excel file first." %}';
            return;
          }
          status.textContent = '{% trans "Processing file..." %}';
          progress.style.display = 'block';
          progress.removeAttribute('value');
          // Server will handle the import; this gives visual feedback only.
        }
      });
    });
  </script>
  {% endif %}
{% endblock %}
