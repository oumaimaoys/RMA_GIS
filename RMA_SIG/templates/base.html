{% load i18n %}
{% load static %}


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}RMA Network GIS{% endblock %}</title>

  <!-- Bootstrap & Icons -->
  <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet">
  <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet">

  <!-- Leaflet (map pages need it) -->
  <link
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      rel="stylesheet">

  <!-- Your global stylesheet -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="icon"       href="{% static 'assets/rma_sig_logo.png' %}" type="image/png">

  {% block head %}{% endblock %}

  <style>

  </style>
</head>

<body>
  <!-- =======  NAVBAR  =================================================== -->
  <nav class="border-bottom py-1 px-3 bg-light">
    <!-- Sidebar (mobile) ------------------------------------------------- -->
    <ul class="sidebar">
      <li class="text-end pe-3">
        <a href="#" onclick="hideSidebar()" class="text-decoration-none text-reset">
          <i class="bi bi-x-lg fs-4"></i>
        </a>
      </li>
      <li><a href="{% url 'home' %}"         class="nav-link px-3">{% trans "home" %}</a></li>
      <li><a href="{% url 'frontend:map' %}" class="nav-link px-3">{% trans "map" %}</a></li>


    </ul>

    <!-- Top-bar (always visible) ---------------------------------------- -->
    <ul class="w-100 justify-content-between align-items-center">
      <li>
        <a href="{% url 'home' %}" class="d-inline-block">
          <img src="{% static 'assets/rma_sig_logo.png' %}" alt="RMA SIG" style="height:32px">
        </a>
      </li>

      <li class="hideOnMobile"><a href="{% url 'home' %}"         class="nav-link px-2">{% trans "home" %}</a></li>
      <li class="hideOnMobile"><a href="{% url 'frontend:map' %}" class="nav-link px-2">{% trans "map" %}</a></li>

      {% if user.is_authenticated %}
      <!-- ── bell (desktop) -->
      {% include "partials/_notif_dropdown.html" %}
      <li class="hideOnMobile"><a href="{% url 'logout' %}" class="nav-link px-2">{% trans "logout" %}</a></li>
      {% endif %}

      <!-- burger -->
      <li class="menu-button">
        <a href="#" onclick="showSidebar()" class="text-decoration-none text-reset">
          <i class="bi bi-list fs-2"></i>
        </a>
      </li>
    </ul>
  </nav>

  <!-- =======  CONTENT  ================================================== -->
  <main class="container-fluid py-3">
    {% block content %}{% endblock %}
  </main>

  <!-- =======  SCRIPTS  ================================================== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    /* —— mobile sidebar helpers —— */
    function showSidebar(){ document.querySelector('.sidebar').style.display = 'flex'; }
    function hideSidebar(){ document.querySelector('.sidebar').style.display = 'none'; }

    /* —— notifications AJAX —— */
    document.addEventListener('DOMContentLoaded', () => {
      // Mark-all
      document.querySelectorAll('.mark-all-form').forEach(form=>{
        form.addEventListener('submit',e=>{
          e.preventDefault();
          fetch(form.action,{method:'POST',headers:{'X-CSRFToken':csrf()}})
            .then(r=>r.ok && location.reload());
        });
      });
      // Toggle single
      document.querySelectorAll('.mark-toggle').forEach(cb=>{
        cb.addEventListener('change',()=>{
          fetch(`/notifications/toggle/${cb.dataset.id}/`,
                {method:'POST',headers:{'X-CSRFToken':csrf()}})
            .then(r=>r.json())
            .then(d=>{
              const link = cb.closest('.dropdown-item').querySelector('a');
              link.classList.toggle('fw-semibold', !d.read);
            });
        });
      });
      function csrf(){
        return document.cookie.split('; ').find(c=>c.startsWith('csrftoken='))?.split('=')[1];
      }
    });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
