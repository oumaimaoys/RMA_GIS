{# templates/office_performance.html #}
{% extends "base.html" %}
{% load static %}

{# 1) Page title #}
{% block title %}RMA Office Performance Analysis{% endblock %}

{# 2) Page-specific CSS #}
{% block head %}
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg,#2c3e50 0%,#34495e 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 300;
    }
    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
      gap: 20px;
      padding: 30px;
      background: linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);
    }
    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      transition: transform .3s ease,box-shadow .3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: #3498db;
      margin-bottom: 10px;
    }
    .stat-label {
      color: #7f8c8d;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .content {
      padding: 30px;
    }
    .section {
      margin-bottom: 40px;
    }
    .section-title {
      font-size: 1.8rem;
      color: #2c3e50;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #3498db;
      display: inline-block;
    }
    .table-container {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #ecf0f1;
    }
    th {
      background: linear-gradient(135deg,#34495e 0%,#2c3e50 100%);
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    tr:hover {
      background-color: #f8f9fa;
      transition: background-color .3s ease;
    }
    .office-type-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: .85rem;
      font-weight: bold;
      text-transform: uppercase;
    }
    .office-type-bgd {
      background: linear-gradient(135deg,#e74c3c,#c0392b);
      color: white;
    }
    .office-type-agent {
      background: linear-gradient(135deg,#27ae60,#229954);
      color: white;
    }
    .currency {
      color: #27ae60;
      font-weight: bold;
    }
    .metric-highlight {
      background: linear-gradient(135deg,#f39c12,#e67e22);
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: .9rem;
    }
    .state-active {
      color: #27ae60;
      font-weight: bold;
    }
    .state-inactive {
      color: #e74c3c;
      font-weight: bold;
    }
    .competitor-count {
      background: #9b59b6;
      color: white;
      padding: 4px 8px;
      border-radius: 50%;
      font-size: .85rem;
      font-weight: bold;
    }
    .no-data {
      color: #95a5a6;
      font-style: italic;
    }
    @media (max-width:768px) {
      .container {
        margin: 10px;
        border-radius: 15px;
      }
      .header h1 {
        font-size: 2rem;
      }
      .stats-overview {
        grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
        gap: 15px;
        padding: 20px;
      }
      .content {
        padding: 20px;
      }
      table {
        font-size: .9rem;
      }
      th, td {
        padding: 10px 8px;
      }
    }
    .performance-rank {
      background: linear-gradient(135deg,#f39c12,#e67e22);
      color: white;
      width: 30px; height: 30px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 10px;
    }
  </style>
{% endblock %}

{# 3) Page markup #}
{% block content %}
  <div class="container">
    <div class="header">
      <h1>RMA Performance Dashboard</h1>
      <p>Comprehensive analysis of office performance and market positioning</p>
    </div>

    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-number">{{ total_bgd }}</div>
        <div class="stat-label">BGD Offices</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ total_agents }}</div>
        <div class="stat-label">Agent Offices</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ office_performance|length }}</div>
        <div class="stat-label">Top Performers</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ bgd_analysis|length }}</div>
        <div class="stat-label">BGD Analysis</div>
      </div>
    </div>

    <div class="content">
      <div class="section">
        <h2 class="section-title">Top Performing Offices</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Rank</th>
                <th>Office</th>
                <th>Type</th>
                <th>Total CA Value</th>
                <th>Average CA</th>
                <th>Years Active</th>
                <th>Nearby Competitors</th>
              </tr>
            </thead>
            <tbody>
              {% for perf in office_performance %}
                <tr>
                  <td>
                    <span class="performance-rank">{{ forloop.counter }}</span>
                  </td>
                  <td>
                    <strong>{{ perf.office.name|default:"N/A" }}</strong>
                    {% if perf.office.location %}
                      <br><small style="color:#7f8c8d;">{{ perf.office.location }}</small>
                    {% endif %}
                  </td>
                  <td>
                    <span class="office-type-badge {% if perf.office_type == 'BGD' %}office-type-bgd{% else %}office-type-agent{% endif %}">

                      {{ perf.office_type }}
                    </span>
                  </td>
                  <td>
                    {% if perf.total_ca > 0 %}
                      <span class="currency">${{ perf.total_ca|floatformat:0 }}</span>
                    {% else %}
                      <span class="no-data">No data</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if perf.avg_ca > 0 %}
                      <span class="currency">${{ perf.avg_ca|floatformat:0 }}</span>
                    {% else %}
                      <span class="no-data">No data</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if perf.years_active > 0 %}
                      <span class="metric-highlight">{{ perf.years_active }} years</span>
                    {% else %}
                      <span class="no-data">No data</span>
                    {% endif %}
                  </td>
                  <td>
                    <span class="competitor-count">{{ perf.nearby_competitors }}</span>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="7" style="text-align:center;padding:40px;color:#95a5a6;">
                    No performance data available
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">BGD Office Analysis</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>BGD Office</th>
                <th>Type</th>
                <th>Partner</th>
                <th>State</th>
                <th>Creation Date</th>
              </tr>
            </thead>
            <tbody>
              {% for bgd in bgd_analysis %}
                <tr>
                  <td>
                    <strong>{{ bgd.bgd.name|default:"N/A" }}</strong>
                    {% if bgd.bgd.location %}
                      <br><small style="color:#7f8c8d;">{{ bgd.bgd.location }}</small>
                    {% endif %}
                  </td>
                  <td>{{ bgd.type_bgd|default:"N/A" }}</td>
                  <td>{{ bgd.partenaire|default:"N/A" }}</td>
                  <td>
                    <span class="{% if bgd.state == 'Active' %}state-active{% else %}state-inactive{% endif %}">

                      {{ bgd.state|default:"Unknown" }}
                    </span>
                  </td>
                  <td>{{ bgd.creation_date|default:"N/A" }}</td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="5" style="text-align:center;padding:40px;color:#95a5a6;">
                    No BGD data available
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
